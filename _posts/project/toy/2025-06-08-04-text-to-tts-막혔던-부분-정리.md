---
title: TextToTTS 프로젝트에서 막혔던 부분 정리
description: 생각보다 음성 부분과 실행 파일로 출력하는게 어렵네;;
date: 2025-08-04 17:21:00 +0900
categories: [프로젝트, 토이 프로젝트]
---

프로젝트 [보기](https://github.com/roooocks/TextToTTS){: target="_blank"}

## pydub에서 ffmpeg 못찾는 문제
pydub의 AudioSegment를 사용해야 음성을 뽑을 수 있는데, 해당 클래스가 ffmpeg를 인식해야 음성을 뽑을 수 있다. <br>
나는 이걸 **ffmpeg 사이트에 가서 파일을 직접 다운** 받은 후 **프로젝트 루트 폴더에 넣어**두고 AudioSegment.converter에 **경로를 저장**하는 방식으로 해결했다.

```python
from pydub import AudioSegment

def get_ffmpeg_path():
    ffmpeg_path = ''
    if getattr(sys, 'frozen', False):  # pyinstaller로 빌드된 실행 파일일 경우
        # 임시 폴더가 있는 디렉터리 기준으로 ffmpeg 경로 설정
        base_path = sys._MEIPASS

        ffmpeg_path = os.path.join(base_path, "ffmpeg.exe")
    else:
        # 개발 환경에서 스크립트 파일 기준으로 ffmpeg 경로 설정
        base_path = os.path.dirname(os.path.abspath(__file__))

        # virtualenv 환경 필수
        ffmpeg_path = os.path.join(base_path, "ffmpeg.exe")
    
    # 경로 확인 및 반환
    if not os.path.isfile(ffmpeg_path):
        raise FileNotFoundError(f"ffmpeg 실행 파일이 존재하지 않습니다: {ffmpeg_path}")
    
    return ffmpeg_path

ffmpeg_path = get_ffmpeg_path()

# ffmpeg 설정
os.environ["PATH"] = os.path.dirname(ffmpeg_path) + os.pathsep + os.environ["PATH"]
AudioSegment.converter = ffmpeg_path
```
{: file='pydub 패키지의 ffmpeg 경로 설정' }


## pyinstaller .env 인식 문제
pyinstaller는 파이썬이 없는 환경에서 python으로 만든 프로그램을 실행시켜주는 프로그램이다. <br>
아래 명령어를 사용하면 실행 파일이 생성된다.
```
pyinstaller --onefile --console project.py

--onfile => 리소스, 라이브러리 등이 실행파일 내부에 들어가 실행 파일을 하나로 만들어줌
--console => 콘솔창 띄우겠다는 뜻. noconsole이면 GUI나 백그라운드에서 돌아간다는 뜻
```
{: file='실행 파일 생성' }

여기까지는 좋았으나 virtualenv에서 문제가 발생했다. 다운받았던 패키지들이 인식을 못하는 문제가 나타난거다. <br>
문제 해결을 위해서는 명령어를 통해 생성된 폴더/파일 중 project.spec 파일의 내용을 아래와 같이 수정해야 한다.
```
# -*- mode: python ; coding: utf-8 -*-

a = Analysis(
    ['main.py'],
    pathex=[],
    binaries=[
        ('./ffmpeg.exe', '.'),
        ('./ffprobe.exe', '.'),
        ('./ffplay.exe', '.')
    ],
    datas=[('./venv/Lib/site-packages', 'site-packages')],
    ...
)

...
```

virtualenv의 내용을 포함시키려면 datas에, 외부 파일의 경우 binaries에 경로를 설정하면 된다. <br>
외부 파일의 경우 추가적으로 PATH 등록을 해놔야 사용 가능하다. Python에서 설정할거면 os.environ["PATH"]로 등록한다.
